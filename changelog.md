# Changelog

## [Unreleased]

### Added
- Search box clearing functionality when navigating between different command modal views
  - Clears search when selecting a provider in models view
  - Clears search when selecting a specific model
  - Clears search when selecting a space
  - Clears search when using quick actions to switch views 
- New space creation form in command modal
  - Added form interface with name, description, provider, and model fields
  - Auto-populates available models based on selected provider
  - Form validation and error handling
  - Smooth navigation with back button support
  - Removed search functionality in form view
  - Fixed "No results found" message to only show during active search
  - Improved space creation workflow from space tab
  - Fixed back button visibility in form view
- Added server-side active space management
  - New setActive flag in space creation API
  - Automatic active space persistence in database
  - Proper active space state handling across sessions
  - Upsert functionality to maintain single active space per user
- Improved spaces list organization
  - Spaces now sorted by last updated date
  - Active space always appears at the top
  - Enhanced visual indication of active space
  - Added "Active" label to current space
  - Improved contrast and visibility of active state
  - Added spacing between space items
  - Enhanced hover effects with subtle transitions
  - Added backdrop blur and border effects
  - Improved visual hierarchy with better shadows
- Added automatic spaces list refresh
  - Command window now fetches latest spaces data when opened
  - Ensures active space is correctly reflected in UI
  - Maintains consistency between backend and frontend state
- Enhanced keyboard navigation in command modal
  - Arrow keys now navigate between search input and list items
  - Up arrow from first list item returns focus to search
  - Down arrow from search moves focus to first list item
  - Maintains natural focus flow for better user experience
  - Preserves existing keyboard shortcuts and navigation
- Improved empty state handling in spaces list
  - Added "No spaces found" message when no spaces exist
  - Moved create space button to center of empty state
  - Enhanced visibility of space creation option
  - Added proper type definitions for space active state
  - Improved user experience for first-time users
- Added keyboard back navigation in command modal
  - Backspace key now acts as back button when search is empty
  - Matches back button behavior for all navigation states
  - Handles space form, spaces list, and models views
  - Preserves search functionality when typing
- Added active provider indication
  - Matches active model styling for consistency
  - Shows active state with visual indicators
  - Added "Active" label to current provider
  - Enhanced visual feedback for active state
- Enhanced default space creation with improved welcome message
  - Added detailed welcome message with AI assistant capabilities
  - Improved onboarding experience for new users
  - Added bullet points for key features and use cases
- Implemented Redis caching with Upstash
  - Added Redis client configuration with TTL settings
  - Implemented caching for spaces, active spaces, conversations, and messages
  - Added cache invalidation on data updates
  - Added cache key generators for consistent key naming
  - Optimized API routes to check cache before database
  - Added background cache updates for better performance
  - Implemented 5-minute TTL for all cached data
  - Added proper cache invalidation on write operations
  - Enhanced response times with Redis caching
- Refactored components into smaller, more focused components following SOLID principles:
  - Extracted SpaceForm into its own component for better separation of concerns
  - Created QuickActionsList component to handle quick action items
  - Created SpacesList component to manage space selection and creation
  - Created ModelsList component to handle model and provider selection
  - Improved component reusability and maintainability
  - Enhanced type safety with proper interfaces
  - Reduced component complexity and improved readability
  - Better separation of concerns and single responsibility principle
  - Improved testability of individual components
- Added Zustand store for managing active space state globally
- Fixed space selection sync between command window and chat interface
- Implemented real-time message streaming in chat interface
  - Added proper typing for streaming response handling
  - Implemented immediate message updates during streaming
  - Added proper state management for streaming messages
  - Fixed message synchronization between streaming and database
  - Added proper error handling for failed responses
- Improved message handling in chat interface:
  - Added real-time message conversion during streaming
  - Added proper model and provider information to all messages
  - Implemented optimized message state management
  - Added proper message persistence before AI responses
  - Enhanced message type safety and validation
  - Improved streaming performance with content equality checks
  - Added proper error handling for message creation
  - Enhanced state synchronization between UI and database
  - Added automatic message extension with space metadata
  - Synchronized AI messages with extended message format
  - Added proper conversation and user context to messages
  - Improved message state management during streaming
- Updated ClientChatContent to use global space store
- Updated QuickActionsCommand to use global space store
- Improved space selection handling to maintain consistency across components
- Improved prop naming in ClientChatContent component
  - Renamed `initialActiveSpace` to `defaultSpace`
  - Renamed `initialConversations` to `defaultConversations`
  - Made prop names more concise and descriptive
- Improved initial space creation and setup flow
  - Added proper sequencing of space creation, activation, and conversation setup
  - Created welcome conversation with initial message
  - Added fallback for setting first space as active if none active
  - Improved error handling with descriptive messages
  - Added proper state refresh after initialization
  - Added proper default provider and model configuration
  - Fixed type safety for provider and model selection
- Added Suspense boundaries with skeleton loading
  - Created TabSkeleton component for navigation tabs
  - Created ChatMessagesSkeleton component for chat messages
  - Added loading states that match the visual style of the app
  - Improved perceived performance with immediate loading feedback
  - Enhanced user experience during data fetching
- Conversations list feature in quick actions command
  - Added ability to view and switch between conversations in the current space
  - Added ability to create new conversations
  - Integrated with existing space and model selection UI
  - Added conversations list component with active conversation indicator
- Added keyboard shortcuts for quick actions
  - ⌘/Ctrl + S to open spaces
  - ⌘/Ctrl + M to open models
  - ⌘/Ctrl + C to open conversations
  - Added visual keyboard shortcut hints to quick actions menu
  - Automatic platform detection for Mac/Windows key symbols
  - Styled keyboard shortcut badges with consistent design
- Enhanced quick actions with command hints
  - Added command hints (e.g., "> spaces", "> models") to each action
  - Styled hints with monospace font and subtle color
  - Combined hints with existing keyboard shortcuts
  - Improved discoverability of command-based navigation

### Changed
- Updated quick actions menu names to be more concise
  - Changed "Switch Space" to "Spaces"
  - Changed "Switch Model" to "Models"
- Improved keyboard shortcut styling
  - Made shortcut keys perfect squares with consistent dimensions
  - Added flex layout for better centering
  - Standardized size to 24x24 pixels
- Improved command modal response time
  - Modal now closes immediately upon selection (space or model)
  - Actions continue in background after modal closes
  - Better user experience with instant feedback
- Improved space creation process
  - Form now only requires space name to be valid
  - Default model is automatically selected
  - Modal closes immediately when creating space
  - Creation process continues in background
  - Faster and more responsive user experience 
  - No loading indicators during space creation
  - Immediate activation of newly created spaces
  - Active space persists across page refreshes
- Enhanced model selection interface
  - Added visual indication of active model
  - Consistent styling with spaces list
  - Added "Active" label to current model
  - Improved hover effects and transitions
  - Better spacing and visual hierarchy
  - Added backdrop blur and border effects
- Unified command modal item styling
  - Consistent hover effects across all items
  - Added subtle borders and transitions
  - Improved spacing and padding
  - Enhanced visual feedback on interaction
  - Standardized rounded corners
  - Added backdrop blur effect to all items
  - Smoother opacity transitions for icons 
- Updated create space button styling
  - Changed to primary action button style
  - Added hover and focus states
  - Improved visual feedback
  - Centered in footer with max width 
- Refactored API routes for better organization and consistency:
  - Centralized all constants in lib/constants.ts:
    - Database table names
    - Column names
    - Message roles
    - Error messages
    - Default values
  - Removed duplicated strings and error messages
  - Standardized error handling across all routes
  - Improved type safety with constant enums
  - Enhanced maintainability with centralized constants
  - Reduced potential for typos and inconsistencies
  - Made database operations more consistent
  - Updated all API routes to use constants:
    - Updated spaces routes
    - Updated conversations routes
    - Updated messages routes
    - Updated chat route
    - Improved error handling consistency
    - Enhanced response formatting
    - Standardized API response structure
- Extended use of constants across the application:
  - Updated quick-actions-command to use constants for:
    - Default space name and description
    - Model and provider configuration
    - Form default values
  - Updated chat component to use constants for:
    - Message roles
    - Error messages
    - Response formatting
  - Updated message component to use constants for:
    - Role definitions
    - Styling configuration
    - Error handling
  - Updated message-input to use constants for:
    - Message roles
    - Form validation
    - Error messages
  - Improved type safety with proper imports
  - Reduced code duplication
  - Enhanced maintainability
  - Standardized configuration across components
- Updated ClientChatContent to use global space store
- Updated QuickActionsCommand to use global space store
- Improved space selection handling to maintain consistency across components
- Improved prop naming in ClientChatContent component
  - Renamed `initialActiveSpace` to `defaultSpace`
  - Renamed `initialConversations` to `defaultConversations`
  - Made prop names more concise and descriptive
- Improved initial space creation and setup flow
  - Added proper sequencing of space creation, activation, and conversation setup
  - Created welcome conversation with initial message
  - Added fallback for setting first space as active if none active
  - Improved error handling with descriptive messages
  - Added proper state refresh after initialization
  - Added proper default provider and model configuration
  - Fixed type safety for provider and model selection
- Refactored ClientChatContent useEffect for better readability and maintainability:
  - Implemented early returns for better flow control
  - Simplified nested conditionals
  - Added proper error handling structure
  - Used optional chaining and nullish coalescing
  - Improved code organization with clear sections
  - Enhanced type safety with proper null checks
  - Added descriptive comments for better code clarity
- Connected SpaceTab and ModelTab components directly to Zustand store for automatic updates
- Removed prop drilling in favor of direct store connection
- Added "No Model Selected" text to ModelTab empty state
- Improved component reactivity for space and model selection changes
- Optimized space switching for better responsiveness
  - Added immediate UI updates when switching spaces
  - Set active space from local state before backend update
  - Improved perceived performance of space switching
- Refactored navigation tabs for better consistency
  - Created reusable BaseTab component
  - Unified styling across all tabs
  - Added consistent hover and active states
  - Maintained specific min-widths for each tab type
  - Improved component maintainability
- Enhanced SpaceTab visual appearance
  - Updated space icon with colorful gradient background
  - Added vibrant indigo-to-pink gradient for better visual hierarchy
  - Improved visual feedback for active spaces
- Simplified command hints in quick actions
  - Removed ">" prefix from commands
  - Shows just the command text (e.g., "spaces", "models")
  - Cleaner, more minimal command display
  - Maintained monospace font and subtle styling
- Updated quick actions command hints
  - Changed to show full command keys (e.g., "> spaces", "> models")
  - Improved visual alignment with Raycast-style command display
  - Enhanced command discoverability with consistent prefix
- Simplified quick actions display
  - Removed command text hints
  - Showing only keyboard shortcut badges
  - Cleaner, more minimal interface
  - Improved visual focus on essential elements
- Reorganized navigation layout:
  - Moved space tab to top center of screen
  - Added conversation tab to bottom navigation
  - Improved visual hierarchy with fixed positioning
  - Maintained consistent styling across all tabs
  - Added active conversation indicator
  - Kept quick actions and model tabs in bottom navigation
  - Enhanced user experience with clear navigation structure
- Improved scroll to bottom button positioning
  - Moved button to appear directly underneath space tab
  - Maintained consistent styling with space tab
  - Enhanced visual hierarchy with proper spacing
  - Improved user experience with clear button placement

### Performance
- Optimized Redis caching implementation
- Reduced unnecessary JSON parsing operations
- Improved cache hit ratio with better invalidation strategy
- Enhanced response times for frequently accessed data
- Implemented Redis helper functions for consistent cache operations:
  - `setCache`: Handles JSON serialization and TTL setting
  - `getCache`: Handles JSON parsing and type safety
  - `deleteCache`: Handles cache invalidation
- Updated all API routes to use new cache helper functions:
  - Spaces route now uses consistent caching pattern
  - Conversations route implements proper cache invalidation
  - Messages route includes improved error handling
- Added proper error logging across all routes
- Implemented consistent error response format
- Optimized message streaming performance in chat interface:
  - Reduced unnecessary state updates during streaming
  - Added content equality checks to prevent redundant updates
  - Eliminated extra API calls after streaming completion
  - Improved state consistency during streaming
  - Enhanced error handling and null checks
  - Reduced re-renders during message streaming
  - Optimized array operations for better performance

### Fixed
- Improved cache invalidation when switching models:
  - Added cache clearing for all conversations in a space
  - Added cache clearing for all messages in affected conversations
  - Added cache clearing for active space and spaces list
  - Fixed issue where old model settings were persisting in cache
  - Added proper cache invalidation triggers in space update endpoint
  - Improved cache key management for model-specific data
  - Enhanced cache consistency during model switches
- Improved message creation error handling:
  - Added proper validation for required fields (content and role)
  - Added clear error messages for missing fields
  - Improved type safety with Message interface
  - Added proper handling of optional fields
  - Enhanced error logging and status codes
  - Fixed "Missing required fields" error during chat
- Fixed JSON parsing errors in Redis caching implementation:
  - Updated conversations route to use new cache helper functions
  - Updated messages route to use new cache helper functions
  - Removed manual JSON.parse/stringify operations
  - Improved error handling in cache operations
  - Fixed type safety in cache data handling
- Improved error handling in API routes
- Enhanced type safety in API responses
- Fixed back button now properly visible at the top of the space creation form
- Added proper padding to modal header when search is hidden
- Adjusted create space button to be more compact and consistent with UI
  - Reduced padding and font size
  - Added border and backdrop blur
  - Adjusted text opacity for better visual harmony
  - Made button width more compact and centered
- Fixed spaces list not updating immediately after creating a new space 
  - Now fetches the complete updated list of spaces from the server after creation
  - Ensures the UI reflects the latest state without requiring a page refresh
- Fixed inconsistent modal behavior when opening from space tab
  - Now uses openQuickActionsCommand instead of toggle to ensure consistent state
  - Prevents state synchronization issues between different open methods
- Fixed space creation initialization issues
  - Now creates initial conversation and welcome message for new spaces
  - Properly initializes all states (spaces, conversations, messages)
  - Ensures smooth transition after space creation
  - Prevents "stuck generating" state in new spaces
  - Added consistent model tags for all messages
  - Removed unnecessary loading states during creation
  - Sets new space as active immediately after creation
  - Persists active space state across page refreshes
- Fixed infinite update loop in state management
  - Removed unnecessary page reload after space creation
  - Improved state update sequence to prevent circular dependencies
  - Fixed maximum update depth exceeded error
- Fixed chat message loading and state management
  - Removed duplicate message loading effects
  - Added message caching to prevent unnecessary reloads
  - Fixed circular dependencies in effects and callbacks
  - Improved streaming message state management
  - Removed unnecessary state updates and re-renders
- Fixed space switching behavior
  - Removed all loading states during space switching
  - Eliminated error state updates for non-critical operations
  - Enhanced user experience with instant space transitions
  - Prevented loading screen from appearing during space changes
  - Maintained smooth UI transitions without interruptions
- Improved keyboard navigation in command modal
  - Fixed arrow key navigation between search and list items
  - Added proper focus management for list items
  - Improved integration with CMDK's built-in navigation
  - Enhanced accessibility for keyboard users
  - Fixed edge cases with focus handling
- Fixed command modal keyboard navigation
  - Properly integrated with CMDK's native keyboard navigation
  - Fixed arrow key navigation between search and items
  - Added support for cycling through items with loop
  - Corrected component hierarchy for better accessibility
  - Removed custom navigation logic that interfered with built-in behavior
- Optimized command modal structure
  - Simplified DOM hierarchy to match CMDK's expectations
  - Fixed keyboard navigation between search and items
  - Enabled simultaneous focus of search and first item
  - Improved filtering and sorting behavior
  - Enhanced list scrolling and item cycling
- Improved command modal structure and navigation
  - Added proper Command.Group components for better keyboard navigation
  - Fixed list item grouping and hierarchy
  - Enhanced focus management between groups
  - Improved accessibility with proper ARIA roles
  - Maintained consistent styling within groups
- Updated Next.js API route params handling for version 15
  - Properly awaiting params object in dynamic route handlers
  - Updated type definitions to reflect Promise-based params
  - Fixed params access pattern to match Next.js 15 requirements
  - Improved type safety with proper Promise typing
  - Added proper async handling in spaces API routes
  - Standardized params handling across all dynamic routes
  - Added model validation in spaces update endpoint
  - Improved space update data handling
- Fixed automatic space creation on first load
  - Added proper error handling in spaces provider
  - Improved initialization logic for new users
  - Added automatic creation of first space when none exist
  - Set proper default values for initial space
- Fixed create space button visibility
  - Button now shows consistently in spaces view
  - Appears both when spaces list is empty and when spaces exist
  - Improved button placement and styling
  - Enhanced user experience for space creation workflow
- Improved keyboard navigation visual feedback
  - Added proper hover effects for keyboard-selected items
  - Unified hover and keyboard selection styles
  - Added data-selected state handling for all command items
  - Enhanced visual feedback for keyboard navigation
  - Improved accessibility with consistent focus styles
  - Fixed opacity transitions for icons during keyboard navigation
  - Added proper group data attributes for nested elements
- Fixed spaces list and creation functionality
  - Added automatic default space creation for new users
  - Improved create space button visibility and styling
  - Fixed empty state handling in spaces list
  - Added proper autofocus to space creation form
  - Enhanced visual feedback for space creation
  - Improved error handling in spaces API
  - Added proper type checking for space active state
  - Fixed space switching behavior
  - Improved user experience for first-time users
- Improved modal structure for fixed footer
  - Added proper flex layout for scrollable content
  - Fixed footer positioning at bottom of modal
  - Added border separator for visual clarity
  - Maintained consistent padding and spacing
- Fixed multiple active spaces issue
  - Added proper clearing of previous active space when creating new space
  - Updated client-side state management to correctly handle active states
  - Removed upsert in favor of delete + insert for active space management
  - Ensured only one space can be active at a time
  - Fixed active state visual indicators
- Fixed active space management in database
  - Resolved unique constraint violation in active_spaces table
  - Improved set_active_space function to properly handle existing records
  - Added explicit check for existing records before update/insert
  - Added DELETE policy for active_spaces table
  - Enhanced error handling in space activation process
- Improved model switching behavior
  - Removed unnecessary loading state updates in status tab
  - Simplified model selection logic
  - Removed error state updates for non-critical operations
  - Enhanced user experience with smoother model switching
- Improved command modal focus management
  - Added automatic focus on first item in nested lists
  - Ensured consistent focus behavior across all navigation states
  - Fixed focus when switching between providers and models
  - Added proper data-selected attributes for visual feedback
  - Improved keyboard navigation experience
- Fixed model name display in default space creation
  - Updated default space creation to use correct model ID from AVAILABLE_MODELS configuration
  - Ensures consistent model naming between UI and backend
  - Fixed customer-facing model names in initial space setup
  - Removed hardcoded model IDs in favor of configuration-based values
- Optimized space creation performance
  - Removed unnecessary loading states during space creation
  - Made modal close immediately after initiating space creation
  - Moved conversation and message creation to background operations
  - Improved initial space creation responsiveness
  - Reduced perceived latency in space switching
  - Eliminated loading screen during space operations
  - Enhanced user experience with instant feedback
  - Optimized state updates for smoother transitions
  - Improved error handling with silent background operations
- Further optimized space creation performance
  - Made conversation and welcome message creation synchronous
  - Ensured initial message appears immediately without refresh
  - Improved state updates to include all related data
  - Enhanced space provider initialization
  - Made initial space creation synchronous
  - Added proper active space handling during initialization
  - Reduced overall latency in space operations
  - Improved state consistency across components
  - Fixed missing welcome message on first load
- Further optimized loading states during space operations
  - Removed loading screen during space creation and initialization
  - Initialized spaces provider with isInitialized true by default
  - Simplified loading state logic to only show during initial auth check
  - Improved state management to prevent unnecessary loading screens
  - Enhanced user experience with immediate UI feedback
  - Optimized space provider initialization flow
  - Removed redundant loading states in protected route
  - Streamlined space creation and switching process
- Fixed JSON parsing errors in Redis caching implementation
  - Updated conversations route to use new cache helper functions
  - Updated messages route to use new cache helper functions
  - Removed manual JSON.parse/stringify operations
  - Improved error handling in cache operations
  - Fixed type safety in cache data handling
- Improved error handling in API routes
- Enhanced type safety in API responses
- Enhanced message creation with proper schema validation:
  - Added validation for role field (must be 'user' or 'assistant')
  - Added proper handling of is_deleted field
  - Added validation for parent_message_id existence
  - Added all required fields from database schema
  - Improved error messages for invalid fields
  - Added warning for invalid parent message references
  - Added required model_used and provider validation for assistant messages
  - Fixed missing fields error during message creation
  - Enhanced error handling and response formatting
  - Improved type safety with Message interface
  - Added proper cache invalidation after message creation
- Refactored chat route for better provider handling:
  - Added centralized provider configuration
  - Improved error handling and response formatting
  - Enhanced type safety with Provider type
  - Added proper validation for provider and model
  - Improved space validation and error messages
  - Enhanced response streaming configuration
  - Added proper error handling for invalid providers
  - Improved type safety in message handling
  - Added proper error responses for invalid requests
  - Enhanced space access validation
- Updated Action type in spaces-provider to allow null for SET_ACTIVE_SPACE payload, fixing type error during user logout
- Fixed model configuration type error
  - Added proper type safety for provider selection
  - Added constants for default provider and model
  - Fixed undefined provider access in getModelName
  - Improved type checking for model configuration
- Fixed model configuration import paths
  - Updated imports to use correct path from @/config/models
  - Separated model configuration from general constants
  - Fixed type error in getModelName function
  - Improved module organization for model-related code
- Improved message handling in chat interface
  - Fixed assistant message streaming and display
  - Added proper message property handling for both user and assistant messages
  - Added model and provider information to assistant messages
  - Fixed message state synchronization between UI and AI messages
  - Added proper timestamp updates for streaming messages
  - Improved message creation with complete required fields
- Fixed chat messages skeleton loading
  - Removed duplicate Suspense boundary in ChatMessages component
  - Moved Suspense handling to parent component level
  - Improved skeleton loading visibility
- Improved QuickActionsTab styling consistency
  - Added active state based on modal open state
  - Matched background and border styling with other tabs
  - Enhanced visual feedback when quick actions are active

## [2024-03-21]
- Fixed event handler error in SpaceTab component by converting it to a Client Component
- Added 'use client' directive to SpaceTab component
- Removed unused handleClick function and onClick handler
- Improved component architecture by properly separating client and server components
- Repositioned navigation tabs (Space, Status, Quick Actions, Model) from top of page to bottom
- Added gradient background for bottom navigation area
- Improved visual hierarchy with tabs appearing directly above UnifiedInput
- Enhanced UX by grouping related controls together at the bottom
- Fixed type error in handleSubmit function to properly handle optional event parameter
- Refined navigation tabs positioning to match UnifiedInput width and placement
- Adjusted tabs to be outside UnifiedInput but maintain same visual alignment
- Fixed width to 800px to match input component
- Improved spacing and centering of navigation elements
- Repositioned navigation tabs to appear above UnifiedInput with proper z-index
- Fine-tuned spacing between tabs and input for better visual hierarchy

## [2024-02-04] Schema Update: Messages Table Annotations - Part 2
- Moved `conversation_id` and `parent_message_id` into the `annotations` JSONB field
- Added database constraint to ensure `conversation_id` is present and valid in annotations
- Updated `get_conversation_messages` function to use conversation_id from annotations
- Improved alignment with Vercel AI SDK message structure

## [2024-02-04] Message Structure Refactoring
- Updated all routes and server actions to use annotations for message metadata
- Moved conversation_id, model_used, provider, and parent_message_id into annotations
- Updated database queries to use JSONB operators for filtering
- Updated RLS policies to use conversation_id from annotations
- Updated Message type definition to reflect new structure
- Improved message creation with proper annotations handling
- Enhanced type safety across all message-related operations

## [2024-02-04] Database Schema Update - Annotations Array Structure

### Changed
- Modified `messages` table `annotations` column from `JSONB` to `JSONB[]` to support array of JSON values
- Updated all queries and indexes to work with the new array-based structure
- Modified validation constraints to handle array structure
- Updated `get_conversation_messages` function to work with JSONB arrays
- Enhanced trigger function to validate both array presence and conversation_id

### Technical Details
- Uses PostgreSQL's native array type with JSONB elements
- Maintains backward compatibility by keeping conversation_id in annotations[0]
- Added array length validation in constraints
- Updated all related queries to use array index notation [0] for accessing conversation_id

## [2024-02-04] Database Schema Fix - JSONB Syntax and Storage

### Changed
- Switched `annotations` from `JSONB[]` to `JSONB` type storing a JSON array
- Updated all JSONB array access syntax from `[0]` to `->0`
- Improved JSONB validation using `jsonb_typeof`
- Updated trigger function to use `jsonb_array_length`
- Fixed all queries and indexes to use proper JSONB operators

### Technical Details
- Now using native JSONB array instead of array of JSONB
- Proper JSONB array access syntax for PostgreSQL
- More robust validation of array structure
- Better handling of NULL cases
- Improved query performance with correct JSONB operators

## [2024-02-04] Message Creation Fix - JSONB Array Handling

### Fixed
- Fixed JSONB array handling in message creation
  - Removed manual JSON stringification
  - Let Supabase handle JSONB serialization
  - Fixed "cannot get array length of scalar" error
  - Improved array handling with proper defaults

### Technical Details
- Direct array passing to Supabase for proper JSONB conversion
- Removed unnecessary JSON.stringify step
- Proper handling of undefined annotations
- Fixed scalar vs array type mismatch

## [2024-02-04] Message Handling Fix - JSONB Path and Format

### Fixed
- Fixed message creation and fetching with proper JSONB handling
  - Updated JSONB path syntax for message queries
  - Fixed annotations array format in message creation
  - Improved message fetching performance with eq instead of filter
  - Added proper conversion of annotations to JSONB array format

### Technical Details
- Using correct JSONB path syntax: `annotations->0->conversation_id`
- Proper wrapping of annotations in array format
- Better query performance with eq operator
- Improved debugging with detailed logging
- Consistent JSONB array structure across operations

## [Unreleased]

### Added
- Added Zustand store for managing active space state globally
- Fixed space selection sync between command window and chat interface

### Changed
- Improved initial space creation and setup flow
  - Added proper sequencing of space creation, activation, and conversation setup
  - Created welcome conversation with initial message
  - Added fallback for setting first space as active if none active
  - Improved error handling with descriptive messages
  - Added proper state refresh after initialization
  - Added proper default provider and model configuration
  - Fixed type safety for provider and model selection
- Improved prop naming in ClientChatContent component
  - Renamed `initialActiveSpace` to `defaultSpace`
  - Renamed `initialConversations` to `defaultConversations`
  - Made prop names more concise and descriptive
- Updated ClientChatContent to use global space store
- Updated QuickActionsCommand to use global space store
- Improved space selection handling to maintain consistency across components

### Fixed
- Fixed model configuration import paths
  - Updated imports to use correct path from @/config/models
  - Separated model configuration from general constants
  - Fixed type error in getModelName function
  - Improved module organization for model-related code
- Fixed active space management in database
  - Resolved unique constraint violation in active_spaces table
  - Improved set_active_space function to properly handle existing records
  - Added explicit check for existing records before update/insert
  - Added DELETE policy for active_spaces table
  - Enhanced error handling in space activation process

 